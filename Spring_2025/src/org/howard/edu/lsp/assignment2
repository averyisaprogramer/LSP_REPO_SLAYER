package org.howard.edu.lsp.assignment2;

import java.io.*;
import java.util.*;
import java.io.IOException;

public class ETLPipeline {

    public static void main(String[] args) {
        String inputFile = "data/products.csv";
        String outputFile = "data/transformed_products.csv";

        try (
            BufferedReader reader = new BufferedReader(new FileReader(inputFile));
            BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile))
        ) {
            String headerLine = reader.readLine();
            writer.write(headerLine + ",PriceRange\n");  

            String line;
            while ((line = reader.readLine()) != null) {
                if (line.trim().isEmpty()) {
                    continue;  // 
                }

                String[] record = line.split(",");
                
                if (record.length < 4) {
                    System.err.println("Skipping invalid line: " + line);
                }

                String productID = record[0];
                String name = record[1].toUpperCase();  
                double price = Double.parseDouble(record[2]);
                String category = record[3];

              
                if (category.equals("Electronics")) {
                    price = price - (price * 0.10);  
                    if (price > 500) {
                        category = "Premium Electronics";  
                    }
                    price = Math.round(price * 100.0) / 100.0;  
                }

 
                String priceRange = getPriceRange(price);

 
                String transformedRecord = String.join(",", productID, name, String.valueOf(price), category, priceRange);

                writer.write(transformedRecord + "\n");
            }

            System.out.println("File transformed successfully!");

        } catch (FileNotFoundException e) {
            System.err.println("Error: Input file not found.");
        } catch (IOException e) {
            System.err.println("Error reading or writing the file: " + e.getMessage());
        } catch (Exception e) {
            System.err.println("An unexpected error occurred: " + e.getMessage());
        }
    }

    private static String getPriceRange(double price) {
        if (price <= 10) {
            return "Low";
        } else if (price <= 100) {
            return "Medium";
        } else if (price <= 500) {
            return "High";
        } else {
            return "Premium";
        }
    }
}
/* code received from these youtube videos: 
 * 
 * https://www.youtube.com/watch?v=zKDmzKaAQro
 * as well as chat gpt and w3edschools
 * 
 */
